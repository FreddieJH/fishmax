---
output: github_document
---

```{r, include = FALSE, message=FALSE }
knitr::opts_chunk$set(
  eval = FALSE,
  collapse = TRUE,
  comment = "#>",
  out.width = "100%"
)
```

# fishmax

<!-- badges: start -->
<!-- badges: end -->

The goal of fishmax provides a robust method to estimate the maximum body length of fishes, with uncertanty. The packages uses two approaches, the first is from Extreme Value Theory (EVT), which shows that the maxima of a set of samples follows a specific distribution - the Generalised Extreme Value (GEV) distribution. The second approach uses knowledge on the underlying body size distribution to estimate the likely parameters of the underlying distribution that would give rise to the observed sample maxima. The two approaches are implemented using a Bayesian Framework. 

## Installation

You can install the development version of fishmax with:

```{r install}
# install.packages("pak")
pak::pak("FreddieJH/fishmax")
```

## Example

This is a basic example which shows you how to fit an EVT and EFS model to a set of maxima values:

```{r load}
library(fishmax)

# five example sample maxima (e.g., max from five fishing competitions)
length_maxima <- c(40, 41, 35, 42, 31) #cm

```

### Model fitting 
First step is to fit the two models.

```{r fit }
# Extreme Value Theory (EVT) and Exact Finite Sample (EFS) models
evt_fit <- fit_mod(length_maxima, model_type = "evt")
efs_fit <- fit_mod(length_maxima, model_type = "efs")
```

### Get $L_{max}$ estimates

You can then obtain the estimates of $L_{max}$ from the models, chosing the credible interval of choice (here we use 80% credible intervals), and the 20-sample maxima. Here, we set $k$ to 20 (default value), to estimate $L_{max}$ if we had 20 samples, this is an arbitrary number but we recommend this value for consistency. Note that this is **not** the number of sample maxima used to fit the model.

```{r}
# estimate the 20-sample LMAX , showing 80% credible intervals
est_max(evt_fit, ci = 0.8, k = 20)
est_max(efs_fit, ci = 0.8, k = 20)
```

### Visualise the $L_{max}$ estimates

```{r visualisation}
# visualise the fit of both the models
plot_model_comparison(
  evt_fit = evt_fit,
  efs_fit = efs_fit,
  data_vector = length_maxima
)
```

### Check the model fit with traceplots

```{r traceplot}
# check to make sure there is convergence of the model parameters
traceplot(evt_fit)
traceplot(efs_fit)
```